<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Campo Harmônico em Cards</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      background: #f8f8f8;
    }

    header {
      position: sticky;
      top: 0;
      background: #f8f8f8;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 10px 0;
      z-index: 10;
    }

    h1 {
      text-align: center;
      margin: 0 0 20px 0;
    }

    .buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }

    .buttons button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      background-color: #bbbbbb;
      color: white;
    }

    #modoButtons button {
      padding: 6px 12px;
      font-size: 14px;
      background-color: #f8f8f8;
      color: black;
    }

    #modoButtons button.selected {
      color: white;
    }

    .buttons button.selected {
      background-color: #1e88e5;
    }

    #tonicButtons button.selected {
      background-color: #002efe;
    }

    #modoButtons button.selected {
      background-color: black;
    }

    .cards {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      padding: 20px;
    }

    .card {
      position: relative;
      background: white;
      border-radius: 8px;
      padding: 15px;
      min-width: 120px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      cursor: pointer;
    }

    .card h3 {
      margin: 0;
      font-size: 22px;
    }

    .card small {
      color: #777;
      display: block;
      margin-bottom: 5px;
    }

    #modosContainer {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: calc(100vh - 350px);
    }

    .popup {
      display: none;
      position: absolute;
      top: 110%;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      white-space: nowrap;
      z-index: 10;
    }

    .card:hover .popup,
    .card.show .popup {
      display: block;
    }

    #modulacoesContainer {
      margin-top: 30px;
      text-align: center;
      padding-bottom: 40px;
    }

    #modulacoesContainer h2 {
      margin-bottom: 10px;
    }
  </style>
</head>

<body>
  <header>
    <h1>Campo Harmônico</h1>
    <div class="buttons" id="modoButtons"></div>
    <div class="buttons" id="tonicButtons"></div>
  </header>

  <div id="modosContainer"></div>
  <div id="modulacoesContainer"></div>

  <script>
    const tonalidades = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];
    const modosNomes = ["Maior (Jônio)", "Menor Natural (Eólio)", "Dórico", "Frígio", "Lídio", "Mixolídio", "Lócrio"];
    const graus = ['I', 'ii', 'iii', 'IV', 'V', 'vi', 'vii°'];
    const funcoes = ['Tônica', 'Subdominante', 'Tônica', 'Subdominante', 'Dominante', 'Tônica', 'Dominante'];
    const campos = {
      "Maior (Jônio)": ['', 'm', 'm', '', '', 'm', '°'],
      "Menor Natural (Eólio)": ['m', '°', '', 'm', 'm', '', ''],
      "Dórico": ['m', 'm', '', '', 'm', '°', ''],
      "Frígio": ['m', '', '', 'm', '°', '', ''],
      "Lídio": ['', '', 'm', '°', '', 'm', 'm'],
      "Mixolídio": ['', 'm', '°', '', 'm', 'm', ''],
      "Lócrio": ['°', '', 'm', 'm', '', '', 'm']
    };

    const variacoesAcordes = {
      'C': ['Cmaj7', 'C6', 'Cadd9'], 'C#': ['C#maj7'], 'D': ['D7', 'D6'],
      'D#': ['D#maj7'], 'E': ['E7', 'Eadd9'], 'F': ['Fmaj7'],
      'F#': ['F#7'], 'G': ['G7', 'G9'], 'G#': ['G#maj7'],
      'A': ['A7', 'A9'], 'A#': ['A#7'], 'B': ['B7', 'Badd9']
    };

    const modulacoesComuns = {
      "Maior (Jônio)": {
        'C': ['G (V)', 'Am (vi)', 'F (IV)'],
        'G': ['D (V)', 'Em (vi)', 'C (IV)'],
        'D': ['A (V)', 'Bm (vi)', 'G (IV)'],
        'A': ['E (V)', 'F#m (vi)', 'D (IV)'],
        'E': ['B (V)', 'C#m (vi)', 'A (IV)'],
        'B': ['F# (V)', 'G#m (vi)', 'E (IV)'],
        'F': ['C (V)', 'Dm (vi)', 'Bb (IV)'],
        'Bb': ['F (V)', 'Gm (vi)', 'Eb (IV)'],
        'Eb': ['Bb (V)', 'Cm (vi)', 'Ab (IV)'],
        'Ab': ['Eb (V)', 'Fm (vi)', 'Db (IV)'],
        'Db': ['Ab (V)', 'Bbm (vi)', 'Gb (IV)'],
        'Gb': ['Db (V)', 'Ebm (vi)', 'Cb (IV)']
      },

      "Menor Natural (Eólio)": {
        'A': ['E (V)', 'F (VI)', 'C (bIII)'],
        'C': ['Gm (v)', 'A♭ (VI)', 'E♭ (bIII)'],
        'D': ['A (V)', 'B♭ (VI)', 'F (bIII)'],
        'E': ['B (V)', 'C (VI)', 'G (bIII)'],
        'F': ['C (V)', 'D♭ (VI)', 'A♭ (bIII)'],
        'G': ['D (V)', 'E♭ (VI)', 'B♭ (bIII)'],
        'B': ['F# (V)', 'G (VI)', 'D (bIII)']
      },

      "Dórico": {
        'D': ['G (IV)', 'A (V)', 'F (bVII)'],
        'A': ['D (IV)', 'E (V)', 'C (bVII)'],
        'E': ['A (IV)', 'B (V)', 'D (bVII)'],
        'B': ['E (IV)', 'F# (V)', 'A (bVII)'],
        'F': ['Bb (IV)', 'C (V)', 'Eb (bVII)'],
        'G': ['C (IV)', 'D (V)', 'F (bVII)']
      },

      "Frígio": {
        'E': ['C (bVI)', 'G (bIII)', 'F (bII)'],
        'A': ['F (bVI)', 'C (bIII)', 'Bb (bII)'],
        'D': ['Bb (bVI)', 'F (bIII)', 'Eb (bII)'],
        'G': ['Eb (bVI)', 'Bb (bIII)', 'Ab (bII)'],
        'C': ['Ab (bVI)', 'Eb (bIII)', 'Db (bII)']
      },

      "Lídio": {
        'F': ['C (V)', 'D (II)', 'G (V/V)'],
        'C': ['G (V)', 'A (II)', 'D (V/V)'],
        'G': ['D (V)', 'E (II)', 'A (V/V)'],
        'D': ['A (V)', 'B (II)', 'E (V/V)'],
        'A': ['E (V)', 'F# (II)', 'B (V/V)'],
        'E': ['B (V)', 'C# (II)', 'F# (V/V)']
      },

      "Mixolídio": {
        'G': ['C (IV)', 'F (bVII)', 'D (V)'],
        'D': ['G (IV)', 'C (bVII)', 'A (V)'],
        'A': ['D (IV)', 'G (bVII)', 'E (V)'],
        'E': ['A (IV)', 'D (bVII)', 'B (V)'],
        'C': ['F (IV)', 'Bb (bVII)', 'G (V)'],
        'F': ['Bb (IV)', 'Eb (bVII)', 'C (V)']
      },

      "Lócrio": {
        'B': ['C (bII)', 'G (bV)', 'D (bVII)'],
        'E': ['F (bII)', 'C (bV)', 'G (bVII)'],
        'A': ['Bb (bII)', 'F (bV)', 'C (bVII)'],
        'D': ['Eb (bII)', 'Bb (bV)', 'F (bVII)'],
        'G': ['Ab (bII)', 'Eb (bV)', 'Bb (bVII)'],
        'C': ['Db (bII)', 'Ab (bV)', 'Eb (bVII)']
      }
    };


    const semitons = {
      'C': 0, 'C#': 1, 'D': 2, 'D#': 3, 'E': 4, 'F': 5,
      'F#': 6, 'G': 7, 'G#': 8, 'A': 9, 'A#': 10, 'B': 11
    };
    const reverseSemitons = Object.entries(semitons).reduce((acc, [note, val]) => { acc[val] = note; return acc; }, {});

    let tomSelecionado = 'C';
    let modoSelecionado = 'Maior (Jônio)';

    const intervalosModos = {
      "Maior (Jônio)": [0, 2, 4, 5, 7, 9, 11],
      "Menor Natural (Eólio)": [0, 2, 3, 5, 7, 8, 10],
      "Dórico": [0, 2, 3, 5, 7, 9, 10],
      "Frígio": [0, 1, 3, 5, 7, 8, 10],
      "Lídio": [0, 2, 4, 6, 7, 9, 11],
      "Mixolídio": [0, 2, 4, 5, 7, 9, 10],
      "Lócrio": [0, 1, 3, 5, 6, 8, 10]
    };


    function gerarCards(tom, modo, sufixos) {
      const base = semitons[tom];
      const cards = [];
      const intervalos = intervalosModos[modo];
      for (let i = 0; i < 7; i++) {
        const nota = reverseSemitons[(base + intervalos[i]) % 12];
        const acorde = nota + sufixos[i];
        const grau = graus[i];
        const funcao = funcoes[i];
        const variacoes = variacoesAcordes[nota] || [];
        const popup = `<div class="popup"><strong>${acorde}</strong><br>Modo: ${modo}<br>Grau: ${grau}<br>Função: ${funcao}` +
          (variacoes.length ? `<br>Variações: ${variacoes.join(', ')}` : '') + `</div>`;
        cards.push(`<div class="card" onclick="this.classList.toggle('show')"><h3>${acorde}</h3><small>${grau}</small>${popup}</div>`);
      }
      return `<div class="cards">${cards.join('')}</div>`;
    }


    function gerarModulacoes(tomAtual) {
      const container = document.getElementById('modulacoesContainer');
      container.innerHTML = '';
      const mods = modulacoesComuns[modoSelecionado]?.[tomAtual] || [];
      if (!mods.length) return;

      const title = document.createElement('h2');
      title.textContent = 'Modulações Comuns';
      container.appendChild(title);

      const div = document.createElement('div');
      div.classList.add('buttons');

      mods.forEach(tom => {
        const btn = document.createElement('button');
        btn.textContent = tom;
        btn.onclick = () => {
          const tomBase = tom.replace(/[^A-G#]/g, ''); // tira (V) etc
          tomSelecionado = tomBase;
          modoSelecionado = inferirModoParaTomDestino(tomBase, tomSelecionado, modoSelecionado);
          atualizarCards();
        };
        div.appendChild(btn);
      });

      container.appendChild(div);
    }

    function atualizarCards() {
      const container = document.getElementById('modosContainer');
      container.innerHTML = gerarCards(tomSelecionado, modoSelecionado, campos[modoSelecionado]);
      document.querySelectorAll('#tonicButtons button').forEach(b => b.classList.remove('selected'));
      document.querySelectorAll('#modoButtons button').forEach(b => b.classList.remove('selected'));
      const btom = Array.from(document.querySelectorAll('#tonicButtons button')).find(b => b.textContent === tomSelecionado);
      const bmodo = Array.from(document.querySelectorAll('#modoButtons button')).find(b => b.textContent === modoSelecionado);
      if (btom) btom.classList.add('selected');
      if (bmodo) bmodo.classList.add('selected');
      gerarModulacoes(tomSelecionado);
    }

    function criarBotoes() {
      const tContainer = document.getElementById('tonicButtons');
      tonalidades.forEach(tom => {
        const btn = document.createElement('button');
        btn.textContent = tom;
        btn.onclick = () => { tomSelecionado = tom; atualizarCards(); };
        tContainer.appendChild(btn);
      });
      const mContainer = document.getElementById('modoButtons');
      modosNomes.forEach(modo => {
        const btn = document.createElement('button');
        btn.textContent = modo;
        btn.onclick = () => { modoSelecionado = modo; atualizarCards(); };
        mContainer.appendChild(btn);
      });
    }

    function inferirModoParaTomDestino(tomDestino, tomOrigem, modoOrigem) {
      if (modoOrigem.includes("Menor") || modoOrigem === "Eólio") {
        return "Menor Natural (Eólio)";
      } else {
        return "Maior (Jônio)";
      }
    }

    function ativarEventosDePopup() {
      document.querySelectorAll('.card').forEach(card => {
        card.onclick = (e) => {
          e.stopPropagation(); // impede o clique de propagar pro body
          document.querySelectorAll('.card').forEach(c => {
            if (c !== card) c.classList.remove('show');
          });
          card.classList.toggle('show');
        };
      });

      // Fechar se clicar fora
      document.body.onclick = () => {
        document.querySelectorAll('.card').forEach(card => card.classList.remove('show'));
      };
    }

    criarBotoes();
    atualizarCards();
    ativarEventosDePopup();
  </script>
</body>

</html>
